<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
	    <title>Edit Recipe</title>
	    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.js"></script>
	    <style>
	        html, body {
	            height: 100%;
	            margin: 0;
	        }
	        
	        body {
	            font-family: 'Arial', sans-serif;
	            background-color: #FFF0E5;
	            display: flex;
	            justify-content: center;
	            align-items: center;
	            flex-direction: column;
	            text-align: center;
	            padding: 20px;
	        }
	
	        h1 {
	            color: #A52A2A;
	            margin-bottom: 20px;
	        }
	
	        .content-wrapper {
	            background-color: white;
	            border-radius: 20px;
	            padding: 40px;
	            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	            margin-bottom: 20px;
	            width: 80%;
	            max-width: 800px;
	        }
	
	        .select-container {
	            margin-bottom: 30px;
	        }
	
	        select, input[type="number"] {
	            padding: 8px;
	            margin: 5px 10px;
	            border: 1px solid #ddd;
	            border-radius: 4px;
	            font-size: 14px;
	            min-width: 150px;
	        }
	
	        input[type="number"] {
	            width: 100px;
	        }
	
	        table {
	            width: 100%;
	            border-collapse: collapse;
	            margin: 20px 0;
	            background-color: white;
	        }
	
	        th, td {
	            padding: 12px;
	            text-align: left;
	            border-bottom: 1px solid #ddd;
	        }
	
	        th {
	            background-color: #A52A2A;
	            color: white;
	            font-weight: bold;
	        }
	
	        .link-style {
	            color: #2196F3;
	            text-decoration: none;
	            cursor: pointer;
	            font-weight: bold;
	        }
	
	        .link-style:hover {
	            text-decoration: underline;
	        }
	
	        .delete-link {
	            color: #ff3d3d;
	            cursor: pointer;
	            font-weight: bold;
	        }
	
	        .delete-link:hover {
	            text-decoration: underline;
	        }
	
	        button {
	            background-color: #A52A2A;
	            color: white;
	            border: none;
	            padding: 10px 20px;
	            margin: 10px;
	            border-radius: 20px;
	            cursor: pointer;
	            transition: background-color 0.3s;
	        }
	
	        button:hover {
	            background-color: #8B4513;
	        }
	
	        .red-text {
	            color: #ff3d3d;
	            background: rgba(255,0,0,0.08);
	            border-radius: 8px;
	            padding: 10px;
	            margin: 10px 0;
	            display: block;
	        }
	
	        .green-text {
	            color: #4CAF50;
	            background: rgba(76,175,80,0.08);
	            border-radius: 8px;
	            padding: 10px;
	            margin: 10px 0;
	            display: block;
	        }
	
	        label {
	            font-weight: bold;
	            color: #555;
	        }
	    </style>
	</head>
	<body ng-app="editRecipe" ng-controller="controller">
	  <script	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.js"></script>
			<script>
				/* Without these comments, Thymeleaf will try to parse the Javascript as XML and break itself sometimes */
				/*<![CDATA[*/ 
				var app = angular.module('editRecipe', []);
				app.controller('controller', function($scope, $http, $q) {
	      	//fetch all ingredient names in inventory
	      	$scope.availablelIngredients = [];
	      	$scope.recipes = [];
	      	$scope.recipe = {};
	      	$scope.recipeName = "";
	      	
	        $http.get("/api/v1/inventory").then(function(response) {
	          $scope.availableIngredients = response.data.ingredientList.map(ingredient => ingredient.name);
	        });
	        
	        $http.get("/api/v1/recipes").then(function(response) {
	          $scope.recipes = response.data;
	          for(let i = 0; i < $scope.recipes.length; i++) {console.log($scope.recipes[i]);}
	        });
	        
	        $scope.deleteRow = function(ingredient) {
	          for(let i = 0; i < $scope.recipe.ingredients.length; i++) {
	            if(ingredient === $scope.recipe.ingredients[i]) {
	              $scope.recipe.ingredients.splice(i, 1);
	              break;
	            }
	          }
	        }
	        
	        $scope.addIngredient = function() {
	          $scope.recipe.ingredients.push({name: "", units: 0});
	        }
					
					$scope.submit = function() {
					  $http.put("/api/v1/recipes", $scope.recipe).then(
					    function(success) {
					      console.log("success!");
					      $scope.submitStatus = "Recipe \"" + $scope.recipe.name + "\" updated successfully";
					      $scope.submitStatusClass = "success";
	
					    }, function(rejection) {
					      console.log("failure");
					      $scope.submitStatus = "Error: " + rejection.data.message;
					      $scope.submitStatusClass = "error";
	
					    }
					  );
					}
	        
				});
				
				/* Without these comments, Thymeleaf will try to parse the Javascript as XML and break itself sometimes */
				/*]]>*/
			</script>
			
			
			
	  <h1>Edit Recipe</h1>
	  
	  <form class="center">
	    <div class="select-container">
	      <label for="selectRecipe">Select Recipe:</label>
	      <!-- on change, set the recipe value to the one with the matching name --->
	      <select name="Recipe" id="selectRecipe" class="center" ng-init="recipe = recipes[0].name;" ng-model="recipe" ng-options="r.name for r in recipes">
	      </select>
	      <label for="setPrice">Edit Price:</label>
	      <input id="setPrice" type="number" size="5" ng-model="recipe.price"></input>
	    </div>
	  </form>
	  <br/>
	  
	  <table class="center-table">
	    <tr>
	      <td><strong>Ingredients</strong></td>
	      <td><strong>Units</strong></td>
	      <td><strong>Delete</strong></td>
	    </tr>
	    
	    <tr ng-repeat="ingredient in recipe.ingredients">
	      <td><select ng-model="ingredient.name" ng-options="ing for ing in availableIngredients"></select></td>
	      <td><input type="number" ng-model="ingredient.units"></td>
	      <td><p class="link-style" ng-click="deleteRow(ingredient)">X</p></td>
	    </tr>
	    
	    
	    <tr>
	      <td class="add-ingredient" colspan="3"><p class="link-style" ng-click="addIngredient()">+ Add Ingredient</p></td>
	    </tr>
	  </table>
	  <br/>
	  <br/>
	  <br/>
	  <br/>
	  <script>function goBack() {window.location.href = '/recipe.html';}</script>
	  <div class="center">
	    <p ng-class="{'red-text': submitStatusClass === 'error', 'green-text': submitStatusClass === 'success'}">{{submitStatus}}</p>
			<button type="button" onClick="goBack()">Go Back</button>
			<button type="button" ng-click="submit()">Save Recipe</button>
		</div>
	  
	</body>
</html>